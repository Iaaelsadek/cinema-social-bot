# Cinema Social Bot ğŸ¬ğŸ¤–

A fully automated content creation bot that generates and posts viral Reels about trending movies to Facebook. The bot mimics a "Saye3" (street-smart) Egyptian content creator persona, using natural-sounding Egyptian Arabic voiceovers and dynamic visuals.

## ğŸš€ Key Features

### 1. **The Persona (Cairo Slang Storyteller)**
- Uses **Gemini AI** with a custom prompt to act as a charismatic Egyptian friend telling a story at a cafe.
- **Language:** Authentic Egyptian Slang (Ammiya) only. No Modern Standard Arabic (Fusha).
- **Structure:** Hook -> Story (Gossip Style) -> Call to Action (CTA).

### 2. **The Voice (Natural Egyptian TTS)**
- Uses **Edge-TTS** with the `ar-EG-SalmaNeural` voice.
- Includes a **Phonetic Cleaning** step to remove emojis, normalize text, and ensure smooth pronunciation.

### 3. **The Visuals (3-Tier Fallback System)**
A robust system ensuring a video is always generated:
1.  **Tier 1 (YouTube Trailer):** Automatically finds the official HD trailer using `yt-dlp` (bypassing API keys), then **smart-crops** a dynamic 15-second snippet from the middle (avoiding intros) and mutes the audio.
2.  **Tier 2 (Pexels Cinematic Footage):** If YouTube fails, searches Pexels for high-quality, portrait-oriented cinematic videos (e.g., "mystery", "dark", "dramatic") to match the movie's vibe.
3.  **Tier 3 (Dynamic Slideshow):** If all else fails, downloads high-res backdrops from TMDB and applies a **Ken Burns Effect** (alternating Zoom In/Out) to create a dynamic video flow.

### 4. **Professional Editing**
- **Subtitles:** Uses `moviepy` to burn hardcoded yellow subtitles with a black stroke using the **Cairo-Bold** font (automatically downloaded).
- **Audio Mixing:** Lowers background music/video volume when the voiceover speaks.
- **Aspect Ratio:** Automatically crops and resizes all content to **9:16 (1080x1920)** for Reels.

## ğŸ› ï¸ Tech Stack

- **Python 3.10+**
- **Google Gemini API** (Content Generation)
- **Edge-TTS** (Voiceover)
- **MoviePy 2.1.1** (Video Editing)
- **yt-dlp** (Video Downloading)
- **Requests** (API Interactions)
- **OpenAI Whisper** (Timestamp Extraction for Subtitles)
- **GitHub Actions** (Automation/Scheduling)

## ğŸ“¦ Setup & Installation

### 1. Install Dependencies
```bash
pip install -r requirements.txt
```
*Note: Requires `ffmpeg` installed on your system.*

### 2. Environment Variables (.env)
Create a `.env` file with the following keys:
```ini
TMDB_API_KEY=your_tmdb_key
GEMINI_API_KEY=your_gemini_key
FB_PAGE_TOKEN=your_long_lived_facebook_token
FB_PAGE_ID=your_page_id
PEXELS_API_KEY=your_pexels_key  # Optional but recommended
```

## ğŸ”„ Migration Guide (Moving to Another Server/Platform)

If you are moving this project to a new environment, follow these steps:

### 1. Transfer Code
Copy all files, especially `main.py`, `requirements.txt`, and `.github/workflows/auto_post.yml`.

### 2. Set Up Secrets/Environment Variables
You **MUST** re-configure these secrets in your new environment (e.g., GitHub Secrets, Heroku Config Vars, or local `.env`):
- `TMDB_API_KEY`: Get from [TMDB](https://www.themoviedb.org/).
- `GEMINI_API_KEY`: Get from [Google AI Studio](https://aistudio.google.com/).
- `FB_PAGE_TOKEN`: Get a **Long-Lived Token** (60 days) from [Meta Developers](https://developers.facebook.com/).
  - *Tip:* Ensure the app is in **Development Mode** to avoid verification requirements.
  - *Permissions:* `pages_manage_posts`, `pages_read_engagement`.
- `FB_PAGE_ID`: Your Facebook Page ID.
- `PEXELS_API_KEY`: Get from [Pexels](https://www.pexels.com/api/).

### 3. Install FFmpeg
Ensure `ffmpeg` is installed and added to the system PATH.
- **Linux (Ubuntu/Debian):** `sudo apt update && sudo apt install ffmpeg`
- **Windows:** Download from [gyan.dev](https://www.gyan.dev/ffmpeg/builds/), extract, and add `bin` folder to PATH.
- **macOS:** `brew install ffmpeg`

### 4. Verify Fonts
The bot automatically downloads `Cairo-Bold.ttf` to the `temp/` directory. Ensure the script has **write permissions** to this folder.

## ğŸ› Troubleshooting

- **Facebook Permission Error #100:**
  - **Cause:** The Page Access Token is missing permissions or the app is Live without verification.
  - **Fix:** Keep the app in **Development Mode** and use a token generated by the Admin user with `pages_manage_posts` permission.
- **MoviePy Error (ImageMagick):**
  - **Fix:** This project uses `MoviePy 2.0+` which uses **Matplotlib** or **Pillow** for text, removing the strict dependency on ImageMagick. Ensure `moviepy>=2.1.1` is installed.
- **Gemini Quota Exceeded:**
  - **Fix:** The script includes a fallback mechanism (tries `gemini-2.5-flash` -> `2.0` -> `1.5`). If all fail, check your billing/quota.

## ğŸ“ License
MIT License.
